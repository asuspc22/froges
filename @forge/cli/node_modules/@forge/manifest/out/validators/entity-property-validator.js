"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EntityPropertyValidator = void 0;
const types_1 = require("../types");
const text_1 = require("../text");
const utils_1 = require("../utils");
const isManifestWithModules = (manifest) => {
    var _a;
    return !!((_a = manifest === null || manifest === void 0 ? void 0 : manifest.typedContent) === null || _a === void 0 ? void 0 : _a['modules']);
};
class EntityPropertyValidator {
    async validate(manifest) {
        var _a;
        if (!(manifest === null || manifest === void 0 ? void 0 : manifest.typedContent)) {
            return {
                success: false,
                manifestObject: manifest
            };
        }
        const validationErrors = [];
        if (isManifestWithModules(manifest)) {
            const { yamlContentByLine, typedContent: { modules } } = manifest;
            const appValuesLength = ((_a = modules[types_1.AllModuleTypes.JiraEntityProperty]) === null || _a === void 0 ? void 0 : _a.reduce((acc, module) => acc + module.values.length, 0)) || 0;
            if (appValuesLength > 30) {
                validationErrors.push(Object.assign({ message: text_1.errors.modules.jiraEntityProperty.maxExtractionsPerApp(30), reference: text_1.References.Modules, level: 'error' }, (0, utils_1.findPosition)('app', yamlContentByLine)));
            }
        }
        return {
            success: validationErrors.length === 0,
            manifestObject: manifest,
            errors: validationErrors
        };
    }
}
exports.EntityPropertyValidator = EntityPropertyValidator;
